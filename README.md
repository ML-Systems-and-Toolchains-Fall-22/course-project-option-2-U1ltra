
# 14813 Course Project - Option 2

For our project we decided to work on option 2, which deals with MQTT dataset. The two team members are

- Jiarui Li - jiaruil3@cmu.edu
- Zehua Zhang - 

------

### Overview 
Before working on the code, we look into the dataset and its metadata. MQTTset was built by using IoT-Flock. It is a innovative dataset built specificly for IoT network ML/AI algorithm training. The data is generated by deploying different IoT sensors, including temperature, light intensity, humidity, CO-Gas, motion, smoke, door opening/closure and fan status, connected to an MQTT broker. It is worth notice that there are two types of sampling period, periodic and random. Periodic means the sensor will sample obervations at a predefined fixed time interval (tempereture), while random means the sampling would depend on random events (motion).

### Dataset Features & SQL Table
Basically, the dataset has the features as the simple example shown in the table below. The features can be understand in four main subparts, namely <b>tcp</b>, <b>mqtt</b>, <b>target</b> and <b>dataset</b>. 

- <i>tcp</i> <br>
    Data generated by TCP protocal. According to the underlying paper, only the attributes that can contribute to characterizing potential attacks and legitimate traffic are kept.
    > TODO: more description
- <i>mqtt</i> <br>
    Data generated by mqtt protocal, which is a standard communication protocal used by IoT network system. As TCP, only the attributes that can contribute to characterizing potential attacks and legitimate traffic are kept. More details about [removed attributes](https://www.mdpi.com/1424-8220/20/22/6578/htm) and [MQTT attribute set](http://public.dhe.ibm.com/software/dw/webservices/ws-mqtt/MQTT_V3.1_Protocol_Specific.pdf).
    
    > TODO: more description
- <i>target</i> <br>
    This column is the label / class of the data point. The main goal is to use the other features to prediction the label. It have six possible categorical values, namely <b>slowite</b>, <b>bruteforce</b>, <b>flood</b>, <b>malformed</b>, <b>dos</b>, <b>legitimate</b>
- <i>dataset</i> <br>
    This is an extra column that we added to distinguish data injested from either train (labeled as 0) or test (labeled as 1) dataset. 
</br>

Then we begin to work on our table schema which mainly involves determining the data type of each columns, depending on the data it contains and the meaning it carries.

However, we discovered that the data is quite clean in terms of the data type. Most of the data is in <b>double</b> type or integer type, which is already good numerical representation.

The following are the existing string columns.
```
|-- tcp_flags: string (nullable = true)
|-- mqtt_conack_flags: string (nullable = true)
|-- mqtt_conflags: string (nullable = true)
|-- mqtt_hdrflags: string (nullable = true)
|-- mqtt_msg: string (nullable = true)
|-- mqtt_protoname: string (nullable = true)
|-- target: string (nullable = true)
```

For the <b>flags</b>, we considered about changing them into integer, since they can be represented in integer at this stage. However, it is more reasonable to convert into one-hot encoding later when doing data engineering, since they are nominal type. Same intuition can be applied to <b>target</b> feature.

For <b>mqtt_msg</b>, it is a piece of message without specific form, so it should be kept in string type. And as I inspect <b>mqtt_protoname</b>, it appears to be another nominal feature with two possible labels. 


|         Features          |    Sample Data   |    Data Type   |  Description  |
| ------------------------- |:----------------:| --------------:|:-------------:|
|tcp.flags                  | 0x00000018 |  string  | TCP flags |
|tcp.time_delta             | 0.998867   |  double  | Time TCP stream |
|tcp.len                    | 10         |  integer | TCP Segment Len |
|mqtt.conack.flags          | 0          |  string  | Acknowledge Flags |
|mqtt.conack.flags.reserved | 0.0        |  double  | Reserved | 
|mqtt.conack.flags.sp       | 0.0        |  double  | Session Present |
|mqtt.conack.val            | 0.0        |  double  | Return Code | 
|mqtt.conflag.cleansess     | 0.0        |  double  | Clean Session Flag |
|mqtt.conflag.passwd        | 0.0        |  double  | Password Flag | 
|mqtt.conflag.qos           | 0.0        |  double  | QoS Level |
|mqtt.conflag.reserved      | 0.0        |  double  | (Reserved) |
|mqtt.conflag.retain        | 0.0        |  double  | Will Retain |
|mqtt.conflag.uname         | 0.0        |  double  | User Name Flag |
|mqtt.conflag.willflag      | 0.0        |  double  | Will Flag | 
|mqtt.conflags              | 0          |  string  | Connect Flags |
|mqtt.dupflag               | 0.0        |  double  | DUP Flag |
|mqtt.hdrflags              | 0x00000030 |  string  |  Header Flags |
|mqtt.kalive                | 0.0        |  double  | Keep Alive | 
|mqtt.len                   | 8.0        |  double  | Msg Len |
|mqtt.msg                   | 32         |  string  | Message | 
|mqtt.msgid                 | 0.0        |  double  | Message Identifier |
|mqtt.msgtype               | 3.0        |  double  | Message Type |
|mqtt.proto_len             | 0.0        |  double  | Protocol Name Length |
|mqtt.protoname             | 0          |  string  | Protocol Name |
|mqtt.qos                   | 0.0        |  double  | QoS Level | 
|mqtt.retain                | 0.0        |  double  | Retain |
|mqtt.sub.qos               | 0.0        |  double  | Requested QoS |
|mqtt.suback.qos            | 0.0        |  double  | Granted QoS |
|mqtt.ver                   | 0.0        |  double  | Version | 
|mqtt.willmsg               | 0.0        |  double  | Will Message |
|mqtt.willmsg_len           | 0.0        |  double  | Will Message Length |
|mqtt.willtopic             | 0.0        |  double  | Will Topic |
|mqtt.willtopic_len         | 0.0        |  double  | Will Topic Length |
|target                     | legitimate |  string  | Attack Class Label |
|dataset                    | 0          |  integer | Train / Test Indicator | 



1. primary key?
2. need to write description/constraints for each specific columns?
3. range ?


